## ë¦¬ì•¡íŠ¸ í›…ì„ ì´ìš©í•œ ë§ˆì´í¬ë¡œ ìƒíƒœ ê´€ë¦¬

### ë§ˆì´í¬ë¡œ ìƒíƒœ ê´€ë¦¬ ì´í•´í•˜ê¸°

- ë¦¬ì•¡íŠ¸ì—ì„œì˜ ìƒíƒœ â†’ UIë¥¼ ë‚˜íƒ€ë‚´ëŠ” ëª¨ë“  ë°ì´í„°
- ìƒíƒœ ê´€ë¦¬ëŠ” ë¦¬ì•¡íŠ¸ ê°œë°œ ì‹œ ì¤‘ìš”í•œ ë¬¸ì œ ì¤‘ í•˜ë‚˜
- ë¦¬ì•¡íŠ¸ í›…ì´ ë“±ì¥ ì´í›„: ì¤‘ì•™ ì§‘ì¤‘ì ì¸ ë°©ì‹ì—ì„œ â†’ ê²½ëŸ‰í™”, ë§ˆì´í¬ë¡œí™” ë°©ì‹ìœ¼ë¡œ
- ì „í†µì ì¸ ì¤‘ì•™ ì§‘ì¤‘í˜• ìƒíƒœ ê´€ë¦¬ê°€ ë²”ìš©ì ìœ¼ë¡œ ì‚¬ìš©ëœë‹¤ë©´, ë§ˆì´í¬ë¡œ ìƒíƒœ ê´€ë¦¬ëŠ” ì¢€ ë” ëª©ì  ì§€í–¥ì 
- ëª©ì  ì§€í–¥ì ìœ¼ë¡œ ìƒíƒœë¥¼ ê´€ë¦¬í•œë‹¤? íŠ¹ì • ëª©ì ì— ë”°ë¼ ë‹¤ë¥¸ í•´ê²°ì±… ì œê³µì´ ê°€ëŠ¥í•˜ë‹¤ëŠ” ì˜ë¯¸
  - í¼ ìƒíƒœ, ì„œë²„ ìºì‹œ ìƒíƒœ, ë‚´ë¹„ê²Œì´ì…˜ ìƒíƒœ ë“±
- ëª©ì  ì§€í–¥ì ì¸ ë°©ë²•ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ì—†ëŠ” ìƒíƒœëŠ”? ì—¬ì „íˆ ë²”ìš©ì ì¸ ìƒíƒœ ê´€ë¦¬ê°€ í•„ìš”

> ë”°ë¼ì„œ ë²”ìš©ì ì¸ ìƒíƒœ ê´€ë¦¬ë¥¼ ìœ„í•œ ë°©ë²•ì€ ê°€ë²¼ì›Œì•¼ í•˜ë©°, ê°œë°œìëŠ” ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ì ì ˆí•œ ë°©ë²•ì„ ì„ íƒí•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤.

- ë§ˆì´í¬ë¡œ ìƒíƒœ ê´€ë¦¬ê°€ ê°€ì ¸ì•¼ í•  ê¸°ëŠ¥
  - (í•„ìˆ˜) ê¸°ë³¸ì ì¸ ìƒíƒœ ê´€ë¦¬ ê¸°ëŠ¥ - ìƒíƒœ **ì½ê¸°** / ìƒíƒœ **ê°±ì‹ ** / ìƒíƒœ ê¸°ë°˜ **ë Œë”ë§**
  - (ì¶”ê°€) ë¦¬ë Œë”ë§ ìµœì í™” / í˜¸í™˜ì„± / ë¹„ë™ê¸° ì§€ì› / íŒŒìƒ ìƒíƒœ / ê°„ë‹¨í•œ ë¬¸ë²• ë“±

### ë¦¬ì•¡íŠ¸ í›… ì‚¬ìš©í•˜ê¸°

> ë¦¬ì•¡íŠ¸ í›…ì€ UI ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¡œì§ë§Œ ì¶”ì¶œì´ ê°€ëŠ¥ â†’ ì»¤ìŠ¤í…€ í›… â†’ ê°€ë…ì„±, í…ŒìŠ¤íŠ¸, ìœ ì§€ë³´ìˆ˜ ì¸¡ë©´ì—ì„œ ì´ì 

- `useState`: ì§€ì—­ ìƒíƒœë¥¼ ìƒì„±í•˜ëŠ” ê¸°ë³¸ì ì¸ í•¨ìˆ˜ë¡œ ë¡œì§ì„ ìº¡ìŠí™”í•˜ê³  ì¬ì‚¬ìš© ê°€ëŠ¥
- `useReducer`: ë§ˆì°¬ê°€ì§€ë¡œ ì§€ì—­ ìƒíƒœë¥¼ ìƒì„±í•  ìˆ˜ ìˆìœ¼ë©°, ë³µì¡í•œ ìƒíƒœì— ìˆì–´ `useState`ë¥¼ ëŒ€ì²´í•˜ëŠ” ìš©ë„ë¡œ ìì£¼ ì‚¬ìš©
- `useEffect`: ë¦¬ì•¡íŠ¸ ë Œë”ë§ í”„ë¡œì„¸ìŠ¤ ë°”ê¹¥ì—ì„œ ë¡œì§ì„ ì‹¤í–‰ ê°€ëŠ¥í•˜ë©°, ë¦¬ì•¡íŠ¸ ì»´í¬ë„ŒíŠ¸ ìƒëª… ì£¼ê¸°ì™€ í•¨ê»˜ ë™ì‘

### ì „ì—­ ìƒíƒœ íƒêµ¬í•˜ê¸°

- ì§€ì—­ìƒíƒœë‘ ë°˜ëŒ€ë˜ëŠ” ê°œë…ìœ¼ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ ì„œë¡œ ë©€ë¦¬ ë–¨ì–´ì ¸ ìˆëŠ” ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•˜ëŠ” ìƒíƒœ
- ê¼­ ì‹±ê¸€í„´ì¼ í•„ìš”ëŠ” ì—†ìœ¼ë©°, ì‹±ê¸€í„´ì´ ì•„ë‹ˆë¼ëŠ” ì˜ë¯¸ì—ì„œ ê³µìœ  ìƒíƒœ(shared state)ë¼ê³ ë„ í•¨
- ë¦¬ì•¡íŠ¸ì—ì„œ ì „ì—­ ìƒíƒœë¥¼ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ê°„ë‹¨í•œ ì‘ì—…ì´ ì•„ë‹Œ ì´ìœ 
  - ë¦¬ì•¡íŠ¸ê°€ ì»´í¬ë„ŒíŠ¸ ëª¨ë¸ì— ê¸°ë°˜í•˜ê¸° ë•Œë¬¸
  - ì»´í¬ë„ŒíŠ¸ ëª¨ë¸ì—ì„œëŠ” ì§€ì—­ì„±ì´ ì¤‘ìš”í•˜ë©°, ì´ëŠ” ì»´í¬ë„ŒíŠ¸ê°€ ì„œë¡œ ê²©ë¦¬ë¼ì•¼ í•˜ê³  ì¬ì‚¬ìš©ì´ ê°€ëŠ¥í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸
- ì™œ ì´ë ‡ê²Œ ë§ì€ ì „ì—­ ìƒíƒœ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìˆë‚˜ìš”?
  - ë¦¬ì•¡íŠ¸ëŠ” ì „ì—­ ìƒíƒœì— ëŒ€í•œ ì§ì ‘ì ì¸ í•´ê²°ì±…ì„ ì œê³µí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì— ì´ëŠ” ê³§ ê°œë°œìì™€ ì»´í“¨ë‹ˆí‹°ì˜ ëª«ìœ¼ë¡œ ë‚¨ê²Œ ë¨

### `useState`ì™€ `useReducer`

#### ìœ ì‚¬ì 

- useState

```tsx
const [state, setState] = useState(initialState)
```

- useReducer

```tsx
const [state, dispatch] = useReducer(reducer, initialArg, init?)
```

- **ê°’/í•¨ìˆ˜ë¡œ ê°±ì‹ ** ëª¨ë‘ ê°€ëŠ¥
- **ë² ì¼ì•„ì›ƒ**ì„ í†µí•´ ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€
- **ì§€ì—° ì´ˆê¸°í™”**ë¥¼ í†µí•´ ë¬´ê±°ìš´ ê³„ì‹¼ì´ í¬í•¨ëœ ì´ˆê¸° ìƒíƒœë¥¼ ëŠë¦¬ê²Œ í‰ê°€í•  ìˆ˜ ìˆìŒ

- `useReducer`ë¡œ `useState` êµ¬í˜„í•˜ê¸°

```tsx
const reducer = (prev, action) => (typeof action === 'function' ? action(prev) : action)

const useState = initialState => useReducer(reducer, initialState)
```

- `useState`ë¡œ `useReducer` êµ¬í˜„í•˜ê¸°

```tsx
const useReducer = (reducer, initialArg, init) => {
  const [state, setState] = useState(init ? () => init(initialArg) : initialArg)

  const dispatch = useCallback(action => setState(prev => reducer(prev, action)), [reducer])

  return [state, dispatch]
}
```

#### ì°¨ì´ì 

- ì´ˆê¸°í™” í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸°
  - `useReducer`ì—ì„œë§Œ reducerì™€ initì„ í›…ì´ë‚˜ ì»´í¬ë„ŒíŠ¸ ì™¸ë¶€ì—ì„œ ì •ì˜í•  ìˆ˜ ìˆìŒ
  - `useState`ì—ì„œëŠ” ì´ˆê¸° ìƒíƒœë¥¼ ê³„ì‚°í•˜ëŠ” ìš©ë„ë¡œë§Œ ì‚¬ìš© ê°€ëŠ¥ `useReducer`ì—ì„œ ì²˜ëŸ¼ ì¸ìë¡œ í•¨ìˆ˜ë¥¼ ì „ë‹¬í•  ìˆ˜ ì—†ìŒ

```tsx
const init = count => ({ count })
const reducer = (prev, delta) => ({ ...prev, count: prev.count + delta })

const ComponentWithUseReducer = ({ initialCount }) => {
  const [state, dispatch] = useReducer(reducer, initialCount, init)

  return (
    <div>
      {state.count}
      <button onClick={() => dispatch(1)}>+1</button>
    </div>
  )
}

const ComponentWithUseState = ({ initialCount }) => {
  const [state, setState] = useState(() => init(initialCount))
  const dispatch = delta => setState(prev => reducer(prev, delta))

  return (
    <div>
      {state.count}
      <button onClick={() => dispatch(1)}>+1</button>
    </div>
  )
}
```

- ì¸ë¼ì¸ ë¦¬ë“€ì„œ ì‚¬ìš©í•˜ê¸°
  - `useReducer`ì—ì„œëŠ” ì™¸ë¶€ ë³€ìˆ˜ì— ì˜ì¡´í•˜ëŠ” í˜•íƒœë¡œ ì¸ë¼ì¸ ë¦¬ë“€ì„œ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
  - ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©ë˜ì§€ ì•Šìœ¼ë©° ê¼­ í•„ìš”í•œ ê²½ìš°ê°€ ì•„ë‹ˆë¼ë©´ ê¶Œì¥í•˜ì§€ ì•ŠìŒ

```tsx
const useScore = bonus => useReducer((prev, delta) => prev + delta + bonus, 0)
```

## (+) Concurrent React

> ë™ì‹œì„±ì´ë¼ëŠ” ê°œë…ì´ ë¦¬ì•¡íŠ¸ì—ì„œ ì¤‘ìš”í•œ ê²ƒ ê°™ì•„ ì´ë²ˆ ê¸°íšŒì— v18 ì´ì „ë¶€í„° ë…¼ì˜ë˜ì–´ v18ì— ë„ì…ëœ ë™ì‹œì„± ê°œë…ì— ëŒ€í•´ ì¢€ ë” ì•Œì•„ë´¤ìŠµë‹ˆë‹¤. (ì´ë¯¸ v19 ì–˜ê¸°ê°€ ë‚˜ì˜¤ê³  ìˆëŠ” ì‹œì ì´ì§€ë§Œ...ğŸ˜…)

UIì˜ ë¶€ë“œëŸ¬ìš´ ìƒí˜¸ì‘ìš©ê³¼ íš¨ìœ¨ì ì¸ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ë¥¼ ëª©í‘œë¡œ ë¦¬ì•¡íŠ¸ v18ì—ì„œ ë³¸ê²©ì ìœ¼ë¡œ ì œì•ˆëœ ë Œë”ë§ ë°©ì‹

```text
Async rendering â†’ Concurrent Mode â†’ Concurrent features(v18)
```

#### ë™ì‹œì„± ë Œë”ë§ì˜ ì´ì 

- [ìŠ¤í¬ë¦° í‹°ì–´ë§](https://en.wikipedia.org/wiki/Screen_tearing) ë°©ì§€: í™”ë©´ì´ ê°±ì‹ ë  ë•Œ ì¤‘ê°„ ìƒíƒœê°€ ë³´ì´ëŠ” ë¬¸ì œë¥¼ ì¤„ì—¬ ë¶€ë“œëŸ¬ìš´ í™”ë©´ ì „í™˜ êµ¬í˜„
- ìš°ì„ ìˆœìœ„ ë³´í˜¸: ì‚¬ìš©ì ì…ë ¥ê³¼ ê°™ì€ ì¤‘ìš”í•œ ì‘ì—…ì„ ë¹„ë™ê¸° ì‘ì—…ë³´ë‹¤ ìš°ì„  ì²˜ë¦¬
- ë Œë”ë§ ìµœì í™”: I/O ëŒ€ê¸° ì‹œê°„ì´ë‚˜ ìœ íœ´ ì‹œê°„ ë™ì•ˆ ì‚¬ì „ ë Œë”ë§ì„ í†µí•´ ì•± ì„±ëŠ¥ í–¥ìƒ
- ì• ë‹ˆë©”ì´ì…˜ ë° ë¹„ë””ì˜¤ ì¬ìƒ ê°œì„ : ë¶€ë“œëŸ¬ìš´ í”„ë ˆì„ ì „í™˜ ë° ì„±ëŠ¥ ê°œì„ 

#### ë™ì‹œì„± ë Œë”ë§ì„ ì ìš©í•œ ë¦¬ì•¡íŠ¸ ë Œë”ë§

- Render Phase: Virtual DOM ê¸°ë°˜ìœ¼ë¡œ ì»´í¬ë„ŒíŠ¸ íŠ¸ë¦¬ë¥¼ ì¬êµ¬ì„±í•˜ëŠ” ë‹¨ê³„

  - React v18 ì´í›„ Concurrent Rendering ë„ì…ìœ¼ë¡œ, ì´ ë‹¨ê³„ëŠ” ì²­í¬ ë‹¨ìœ„ë¡œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ë©°, ìš°ì„ ìˆœìœ„ê°€ ë†’ì€ ì‘ì—…ì´ ìˆë‹¤ë©´ ë©”ì¸ ìŠ¤ë ˆë“œë¥¼ ì–‘ë³´(Cooperative Scheduling)í•  ìˆ˜ ìˆìŒ
  - ë©”ì¸ ìŠ¤ë ˆë“œê°€ ë‹¤ë¥¸ ì‘ì—…ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ì‘ì—…ì„ ì¤‘ë‹¨(yield)í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ì´ ë‹¨ê³„ì—ì„œëŠ” API í˜¸ì¶œ, DOM ë³€ê²½ ë“± ë¶€ì‘ìš©(Side Effects)ì„ ìœ ë°œí•˜ëŠ” ì‘ì—…ì€ ì§€ì–‘ â†’ ì´ëŸ¬í•œ ì‘ì—…ì€ ë°˜ë“œì‹œ Commit Phaseì—ì„œ ì²˜ë¦¬í•´ì•¼ í•¨

> Virtual DOM ìƒì„± â†’ ë¹„êµ(Diffing) â†’ ì¬ì¡°ì •(Reconciliation)

- Commit Phase: Render Phaseì—ì„œ ê³„ì‚°ëœ ë³€ê²½ ì‚¬í•­ì„ ì‹¤ì œ DOMì— ì ìš©í•˜ëŠ” ë‹¨ê³„
  - ì´ ë‹¨ê³„ì—ì„œëŠ” DOM ì—…ë°ì´íŠ¸ê°€ ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©°, `useEffect`ë‚˜ `useLayoutEffect` ê°™ì€ effect ê´€ë ¨ ë¡œì§ë„ ì‹¤í–‰ë¨
  - Commit PhaseëŠ” í•­ìƒ ì¤‘ë‹¨ ì—†ì´ ëê¹Œì§€ ì‹¤í–‰ë¨

#### ì „ì—­ ìƒíƒœì˜ ë¶ˆì¼ì¹˜ ë¬¸ì œ

> ë™ì‹œì„± ë Œë”ë§ì—ì„œ ì „ì—­ ìƒíƒœì˜ ë¶ˆì¼ì¹˜ë¡œ ì¸í•´ [tearing](https://github.com/reactwg/react-18/discussions/69)ì´ ë°œìƒí•  ìˆ˜ ìˆìŒ
>
> - tearing: _"ì°¢ì–´ì§"_, UIê°€ ë™ì¼í•œ ìƒíƒœì— ëŒ€í•´ ì„œë¡œ ë‹¤ë¥¸ ê°’ì„ í‘œì‹œí•˜ëŠ” ê²½ìš°
>   ![image.png](https://user-images.githubusercontent.com/2440089/124805949-29edc180-df2a-11eb-9621-4cd9c5d0bc5c.png)

- Mutable Store ë¬¸ì œ
  - ì „ì—­ ìƒíƒœê°€ ë¹ ë¥´ê²Œ ë³€ê²½ë  ê²½ìš°, ìƒíƒœë¥¼ ì½ëŠ” ì»´í¬ë„ŒíŠ¸ì—ì„œ ë°ì´í„° ë¶ˆì¼ì¹˜ ë°œìƒ ê°€ëŠ¥
  - í•´ê²° ë°©ì•ˆ: (1) ë™ê¸°ì  ë Œë”ë§ í™œìš© / (2) ìƒíƒœë¥¼ ë¶ˆë³€ì„±ì„ ì§€ì¼œ ê´€ë¦¬

#### ì£¼ìš” Concurrent Features

> [React v18.0](https://ko.react.dev/blog/2022/03/29/react-v18#what-is-concurrent-react)ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê°„ë‹¨íˆ ì •ë¦¬

- Strict Mode: Concurrent Featuresì˜ ì‘ë™ì„ í…ŒìŠ¤íŠ¸í•˜ê³  ë””ë²„ê¹…í•˜ëŠ” ëª¨ë“œë¡œ `Strict Mode`ì—ì„œ ë°œìƒí•˜ëŠ” ë‘ ë²ˆì˜ ë Œë”ë§ì€ ê°œë°œ ëª¨ë“œì—ì„œë§Œ ë™ì‘
- ìë™ Batching: ì—¬ëŸ¬ ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ í•˜ë‚˜ì˜ ë Œë”ë§ ì‚¬ì´í´ë¡œ ë¬¶ì–´ì„œ ì²˜ë¦¬

```tsx
setCount(count + 1)
setFlag(true)
// ê¸°ì¡´: ë‘ ë²ˆ ë Œë”ë§ â†’ v18: í•œ ë²ˆì˜ ë Œë”ë§ìœ¼ë¡œ ì²˜ë¦¬
```

- Transitions: ê¸´ê¸‰ ì—…ë°ì´íŠ¸(ë²„íŠ¼ í´ë¦­, ì…ë ¥)ì™€ ê¸´ê¸‰í•˜ì§€ ì•Šì€ ì—…ë°ì´íŠ¸(UI ì• ë‹ˆë©”ì´ì…˜)ë¥¼ êµ¬ë¶„í•˜ê¸° í•˜ì—¬ UI ì„±ëŠ¥ ê°œì„ 
- ìš°ì„ ìˆœìœ„ ê´€ë ¨ í›…ê³¼ API â†’ UI ìš°ì„ ìˆœìœ„ ê´€ë¦¬ ë° ë¹„ë™ê¸°ì  ì‘ì—… ì²˜ë¦¬ ìµœì í™”
  - `useTransition`, `startTransition`: ë‚®ì€ ìš°ì„ ìˆœìœ„ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” í›…ê³¼ í•¨ìˆ˜
  - `useDeferredValue`: ë¹„ë™ê¸°ì ìœ¼ë¡œ ê°’ì„ ì§€ì—° ì²˜ë¦¬í•˜ì—¬, ê¸´ ë Œë”ë§ ì‘ì—… ë™ì•ˆì— UIë¥¼ ë¹ ë¥´ê²Œ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆë„ë¡ ì§€ì›
